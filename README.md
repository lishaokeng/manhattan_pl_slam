# manhattan_pl_slam

使用曼哈顿假设全局约束的点线vslam

## 介绍

- 本项目为点线视觉slam项目。

### 项目亮点和发展历程

本项目设计初衷为`泊车场景`下的`视觉轮速`里程计，在低功耗嵌入式平台（TDA4 A核）上提供`快速实时`的`高精度`里程计算法。主要改进思路均以此为前提。
1. 众所周知，传统vslam算法主要分为特征点法(ORB-SLAM)、半直接法(SVO、VINS)和直接法(DSO)。考虑到ORB-SLAM耗时太高、SVO定位精度过低且DSO对光度变化和相机标定参数过于敏感，本项目基线由VINS去除IMU后改进得到，在尽量对光度变化不敏感的情况下耗时最低；
2. 单目vslam有尺度漂移问题，因此添加轮速计尺度约束，解决尺度漂移问题（尺度约束由本人推导并实现的行驶轨迹曲线模长尺度，网上无资料）；
3. 对主要模块做耗时优化：弃用opencv图像金字塔算法，手动实现并优化图像金字塔算法，耗时为opencv的2/3且比opencv耗时稳定（参考BASALT）；
4. 对主要模块做耗时优化：弃用opencv光流跟踪算法，手动实现逆向组合光流，耗时为opencv的1/4(参考逆向组合光流法论文)；
5. 对主要模块做耗时优化：弃用vins的前端BA优化，改为手动实现逆向BA，耗时为ceres的1/3（参考半直接法SVO）；
6. 考虑到纯特征点vslam鲁棒性不足且累积误差较大，决定引入线特征。由于本项目使用场景为泊车场景，泊车场景一定存在结构化线条（车位线等），决定引入曼哈顿假设，这一步改进极大提高定位精度，曼哈顿假设引入了旋转角的全局约束，保证全局旋转无累积误差，且平移误差达到10-20cm/100m。（线段提取在对比不同方案后使用ELSED线段和ZNCC匹配，在所有方案中耗时最低。曼哈顿假设参考manhattan-slam和structure-slam）
7. 由于VINS前端的特征点使用光流进行前后帧跟踪，光流跟踪优点是耗时低，缺点是：①在纹理较少或边缘上提取的fast点，跟踪精度极低，基本上都会跟踪错误（可视化显示可以很明显感受到）。②图像质量不佳时召回率较低（低于100个）。这两点导致偶现系统里特征点的外点占比过高，而最小二乘和极大似然方法又需要内点观测越多计算结果越准确，因此引入特征点深度滤波器。这一步改进极大减少了系统里特征点外点数量，提高特征点跟踪数量，保证特征点的深度稳定性（参考半直接法SVO和直接法DSO）；
8. 考虑到原论文中的曼哈顿结构线初始化方案过于粗糙，对条件数不够无法三角化的线段进行了初始化，导致一定概率引入错误的结构线，进而导致优化的偏离。弃用原论文的曼哈顿结构线初始化和优化约束等，改为使用普吕克线段（仅对观测平面存在夹角的线段进行三角化初始化，不会引入错误线段）。（参考PL-VIO）
9. 在普吕克线段基础上改进得到曼哈顿假设，同方向线段进行聚类并添加线段方向约束，即依然保证了全局旋转约束。
10. 考虑到ELSED线段提取召回率不够高，改进思路：在特征点BA后对已初始化的线段进行投影，匹配edge-drawing锚点，极大提高已初始化线段跟踪的召回率接近100%。
11. 考虑到AVM俯视四路拼接图基于地面和车底面一致的假设，使用该俯视图进行建图会导致假设地图误差大（因为该假设实际上总是不满足），车位线误差一般在0.5m-1m左右。改进思路：对语义分割点云进行重新投影到曼哈顿平面，从根本上去除地面假设的依赖，建图车位线相比之前方案几乎无误差。（参考激光slam cartographer子图拼接和更新）
